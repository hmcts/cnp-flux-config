apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: flux-system
resources:
  - https://github.com/fluxcd/flux2/manifests/integrations/registry-credentials-sync/azure?ref=main
  - ../../backstage/automation
  - ../../cnp/automation
  - ../../slack-help-bot/automation
commonAnnotations:
  kustomize.toolkit.fluxcd.io/substitute: disabled

patchesStrategicMerge:
  - config-patches.yaml
patches:
  - path: hmctspublic-image-repo.yaml
    target:
      kind: ImageRepository
      annotationSelector: hmcts.github.com/image-registry != hmctsprivate
  - path: prod-image-policy.yaml
    target:
      kind: ImagePolicy
      annotationSelector: hmcts.github.com/prod-automated != disabled