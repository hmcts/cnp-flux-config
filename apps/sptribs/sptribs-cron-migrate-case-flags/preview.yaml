apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: sptribs-cron-migrate-case-flags
spec:
  releaseName: sptribs-cron-migrate-case-flags
  values:
    job:
      image: hmctspublic.azurecr.io/sptribs/case-api:pr-1498-e66957e-20231120150811 #{"$imagepolicy": "flux-system:sptribs-case-api"}
      keyVaults:
        sptribs:
          secrets:
            - name: AppInsightsInstrumentationKey
              alias: APP_INSIGHTS_KEY
            - name: uk-gov-notify-api-key
              alias: UK_GOV_NOTIFY_API_KEY
            - name: s2s-case-api-secret
              alias: S2S_SECRET
            - name: idam-secret
              alias: IDAM_CLIENT_SECRET
            - name: idam-systemupdate-username
              alias: IDAM_SYSTEM_UPDATE_USERNAME
            - name: idam-systemupdate-password
              alias: IDAM_SYSTEM_UPDATE_PASSWORD
      environment:
        TASK_NAME: SystemMigrateCaseFlagsTask
      schedule: 0/10 * * * *
    global:
      environment: preview
      tenantId: "531ff96d-0ae9-462a-8d2d-bec7c0b42082"
      enableKeyVaults: true
  chart:
    spec:
      chart: sptribs-cron
      version: 0.0.15
      sourceRef:
        kind: HelmRepository
        name: hmctspublic
        namespace: flux-system
