apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: ccpay-callback-function-int
spec:
  values:
    function:
      image: hmctspublic.azurecr.io/ccpay/callback-function:prod-de0d84d-20240328103238 #{"$imagepolicy": "flux-system:demo-int-ccpay-callback-function"}
      aadIdentityName: ccpay
      triggers:
        - type: azure-servicebus
          topicName: "servicecallbacktopic"
          subscriptionName: defaultServiceCallbackSubscription
          connectionFromEnv: SERVICE_CALLBACK_BUS_CONNECTION
          queueLength: 1
      environment:
        S2S_URL: http://rpe-service-auth-provider-demo.service.core-compute-demo.internal
        MICROSERVICE_PAYMENT_APP: "payment_app"
        SERVICE_LOGGING_ENABLED: false
        DUMMY_RESTART_VAR: true
      keyVaults:
        "ccpay":
          secrets:
            - name: payment-s2s-secret
              alias: S2S_KEY_PAYMENT_APP
            - name: sb-primary-connection-string
              alias: SERVICE_CALLBACK_BUS_CONNECTION
            - name: AppInsightsInstrumentationKey
              alias: APPINSIGHTS_INSTRUMENTATIONKEY