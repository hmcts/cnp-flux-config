apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: nfdiv-cron-migrate-bulk-cases
spec:
  releaseName: nfdiv-cron-migrate-bulk-cases
  values:
    job:
      environment:
        TASK_NAME: SystemMigrateBulkCasesTask
      useInterpodAntiAffinity: true
      image: hmctspublic.azurecr.io/nfdiv/case-api:prod-e1c818f-20231115151736 #{"$imagepolicy": "flux-system:nfdiv-case-api"}
    keyVaults:
      nfdiv:
        secrets:
          - name: app-insights-connection-string
            alias: app-insights-connection-string
          - name: uk-gov-notify-api-key
            alias: UK_GOV_NOTIFY_API_KEY
          - name: s2s-case-api-secret
            alias: S2S_SECRET
          - name: idam-secret
            alias: IDAM_CLIENT_SECRET
          - name: idam-systemupdate-username
            alias: IDAM_SYSTEM_UPDATE_USERNAME
          - name: idam-systemupdate-password
            alias: IDAM_SYSTEM_UPDATE_PASSWORD
    schedule: 0/10 * * * *
  chart:
    spec:
      chart: nfdiv-cron
      version: 0.0.19
      sourceRef:
        kind: HelmRepository
        name: hmctspublic
        namespace: flux-system
