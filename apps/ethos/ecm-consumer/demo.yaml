apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: ecm-consumer
  namespace: ethos
spec:
  releaseName: ecm-consumer
  values:
    java:
      image: hmctspublic.azurecr.io/ethos/ecm-consumer:prod-6316e94-20230418123458 #{"$imagepolicy": "flux-system:demo-ecm-consumer"}
      ingressHost: ethos-ecm-consumer-demo.service.core-compute-demo.internal
      keyVaults:
        ethos-shared:
          resourceGroup: ethos
          secrets:
            - name: app-insights-connection-string
              alias: app-insights-connection-string
            - name: ecm-consumer-s2s-key
              alias: ECM_CONSUMER_S2S_KEY
            - name: caseworker-user-name
              alias: CASEWORKER_USER_NAME
            - name: caseworker-password
              alias: CASEWORKER_PASSWORD
            - name: create-updates-queue-send-connection-string
              alias: CREATE_UPDATES_QUEUE_SEND_CONNECTION_STRING
            - name: create-updates-queue-listen-connection-string
              alias: CREATE_UPDATES_QUEUE_LISTEN_CONNECTION_STRING
            - name: update-case-queue-send-connection-string
              alias: UPDATE_CASE_QUEUE_SEND_CONNECTION_STRING
            - name: update-case-queue-listen-connection-string
              alias: UPDATE_CASE_QUEUE_LISTEN_CONNECTION_STRING
            - name: idam-client-secret
              alias: IDAM_CLIENT_SECRET
            - name: ecm-consumer-postgres-password
              alias: ECM_CONSUMER_POSTGRES_PASSWORD
            - name: ecm-consumer-postgres-user
              alias: ECM_CONSUMER_POSTGRES_USER
            - name: ecm-consumer-postgres-host
              alias: ECM_CONSUMER_POSTGRES_HOST
            - name: ecm-consumer-postgres-port
              alias: ECM_CONSUMER_POSTGRES_PORT
            - name: ecm-consumer-postgres-database
              alias: ECM_CONSUMER_POSTGRES_DATABASE
      aadIdentityName: ethos
      environment:
        REFORM_TEAM: ethos
        REFORM_SERVICE_NAME: ecm-consumer
        REFORM_SERVICE_TYPE: java
        REFORM_ENVIRONMENT: preview
        ROOT_LOGGING_LEVEL: INFO
        LOG_OUTPUT: single
        ECM_CONSUMER_URL: "http://ethos-ecm-consumer-demo.service.core-compute-demo.internal"
        IDAM_API_URL: "https://idam-api.demo.platform.hmcts.net"
        IDAM_API_JWK_URL: "https://idam-api.demo.platform.hmcts.net/jwks"
        IDAM_API_OIDC_URL: "https://idam-api.demo.platform.hmcts.net/o/token"
        IDAM_CLIENT_REDIRECT_URL: "https://ecm-consumer-demo.service.core-compute-demo.internal/oauth2redirect"
        SERVICE_AUTH_PROVIDER_URL: "http://rpe-service-auth-provider-demo.service.core-compute-demo.internal"
        CCD_DATA_STORE_API_URL: "http://ccd-data-store-api-demo.service.core-compute-demo.internal"
        CCD_GATEWAY_BASE_URL: "https://manage-case.demo.platform.hmcts.net"
        MICRO_SERVICE: "ecm_consumer"
        ECM_CONSUMER_DB_CONN_OPTIONS: ?sslmode=require
