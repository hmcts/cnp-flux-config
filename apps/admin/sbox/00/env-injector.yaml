apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: env-injector-webhook
  namespace: admin
spec:
  values:
    tolerations:
    - effect: NoSchedule
      key: CriticalAddonsOnly
      operator: Equal
      value: "true"
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
          labelSelector:
        matchExpressions:
        - key: app
          operator: In
        values:
          - env-injector-webhook
            topologyKey: "kubernetes.io/hostname"
    nodeAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 1
        preference:
      matchExpressions:
      - key: kubernetes.azure.com/mode
        operator: In
        values:
        - system