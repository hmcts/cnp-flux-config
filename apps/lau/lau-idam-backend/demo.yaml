apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: lau-idam-backend
spec:
  values:
    java:
      memoryRequests: "1024Mi"
      cpuRequests: "500m"
      memoryLimits: "2048Mi"
      cpuLimits: "1500m"
      applicationPort: 4550
      image: 'hmctspublic.azurecr.io/lau/idam-backend:latest'
      ingressHost: lau-idam-backend-demo.service.core-compute-demo.internal
      aadIdentityName: lau
      environment:
        LAU_IDAM_DB_NAME: lau_idam
        LAU_IDAM_DB_HOST: lau-idam-backend-flexible-demo.postgres.database.azure.com
        LAU_IDAM_DB_PORT: "5432"
        FLYWAY_URL: jdbc:postgresql://lau-idam-backend-flexible-demo.postgres.database.azure.com:5432/lau_idam?sslmode=require
        FLYWAY_USER: lauadmin
        FLYWAY_NOOP_STRATEGY: "false"
        LAU_IDAM_DB_CONN_OPTIONS: "?sslmode=require"
        LAU_IDAM_ENCRYPTION_ENABLED: "Yes"
        S2S_URL: "http://rpe-service-auth-provider-demo.service.core-compute-demo.internal"
        IDAM_API_URL: "https://idam-api.demo.platform.hmcts.net"
        IDAM_CLIENT_REDIRECT_URI: "https://lau-idam-backend-demo.service.core-compute-demo.internal/oauth2/callback"
        IDAM_CLIENT_NAME: 'lau'
        LAU_FLYWAY_MIGRATE_DB: "false"
        DB_ALLOW_DELETE_RECORD: "false"
        TRIGGER_DEPLOY: trigger4
      keyVaults:
        lau:
          resourceGroup: lau
          secrets:
          - name: idam-backend-POSTGRES-USER
            alias: LAU_IDAM_DB_ADMIN_USERNAME
          - name: idam-backend-POSTGRES-PASS
            alias: LAU_IDAM_DB_ADMIN_PASSWORD
          - name: idam-backend-app-db-user
            alias: LAU_IDAM_DB_USERNAME
          - name: idam-backend-app-db-password
            alias: LAU_IDAM_DB_PASSWORD
          - name: idam-flyway-password
            alias: flyway.password
          - name: backend-encryption-key
            alias: LAU_IDAM_ENCRYPTION_KEY
          - name: idam-client-secret
            alias: IDAM_CLIENT_SECRET
          - name: app-insights-connection-string
            alias: app-insights-connection-string
          - name: idam-backend-POSTGRES-HOST-FLEXIBLE
            alias: LAU_IDAM_DB_FLEXIBLE_HOST
          - name: idam-backend-POSTGRES-PORT-FLEXIBLE
            alias: LAU_IDAM_DB_FLEXIBLE_PORT
          - name: idam-backend-POSTGRES-USER-FLEXIBLE
            alias: LAU_IDAM_DB_FLEXIBLE_ADMIN_USERNAME
          - name: idam-backend-POSTGRES-PASS-FLEXIBLE
            alias: LAU_IDAM_DB_FLEXIBLE_ADMIN_PASSWORD
