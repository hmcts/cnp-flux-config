apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: bar-api-int
spec:
  releaseName: bar-api-int
  values:
    java:
      image: hmctspublic.azurecr.io/bar/api:prod-8fc5f12-20231103144315 #{"$imagepolicy": "flux-system:bar-api"}
      environment:
        DUMMY_RESTART_VAR: false
        POSTGRES_NAME: postgresqldb2
        PAYMENT_API_URL: http://payment-api-int-{{ .Values.global.environment }}.service.core-compute-{{ .Values.global.environment }}.internal
      keyVaults:
        "bar":
          resourceGroup: bar
          secrets:
            - name: api-POSTGRES-PASS-V15
              alias: POSTGRES_PASSWORD
            - name: api-POSTGRES-HOST-V15
            - alias: POSTGRES_HOST
            - name: api-POSTGRES-USER-V15
            - alias: POSTGRES_USERNAME
            - name: bar-S2S-SECRET
              alias: S2S_SECRET
            - name: api-POSTGRES-PORT-V15
              alias: POSTGRES_PORT
            - name: AppInsightsInstrumentationKey
              alias: azure.application-insights.instrumentation-key
