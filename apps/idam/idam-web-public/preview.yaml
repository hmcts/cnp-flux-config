apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: idam-web-public
  namespace: idam
spec:
  values:
    java:
      image: hmctspublic.azurecr.io/idam/web-public:preview-7e6273d-20211125092032 #{"$imagepolicy": "flux-system:preview-idam-web-public"}
      ingressHost: idam-web-public.service.core-compute-preview.internal
      replicas: 2
      environment:
        GA_TRACKING_ID: "UA-122164129-3"
        STRATEGIC_SERVICE_URL: http://idam-api
        STEP_UP_AUTHENTICATION: true
    global:
      environment: preview
      tenantId: "531ff96d-0ae9-462a-8d2d-bec7c0b42082"
      enableKeyVaults: true
    securityContext:
      sysctls:
        - name: net.ipv4.tcp_retries2
          value: "3"
  chart:
    spec:
      chart: idam-web-public
      version: 0.2.2
      sourceRef:
        kind: HelmRepository
        name: hmctspublic
        namespace: flux-system