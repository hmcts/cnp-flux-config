---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: ccd-full
  namespace: ccd
  annotations:
    flux.weave.works/automated: 'true'
    flux.weave.works/tag.ccd-full-admin-web: glob:latest
    flux.weave.works/tag.ccd-full-api-gateway: glob:latest
    flux.weave.works/tag.ccd-full-case-management-web: glob:latest
    flux.weave.works/tag.ccd-full-data-store-api: glob:latest
    flux.weave.works/tag.ccd-full-definition-store-api: glob:latest
    flux.weave.works/tag.ccd-full-dm-store: glob:latest
    flux.weave.works/tag.ccd-full-draft-store: glob:latest
    flux.weave.works/tag.ccd-full-em-annotation: glob:latest
    flux.weave.works/tag.ccd-full-s2s: glob:latest
    flux.weave.works/tag.ccd-full-user-profile-api: glob:latest
    flux.weave.works/tag.ccd-full-definition-importer: glob:latest
    flux.weave.works/tag.ccd-full-user-profile-importer: glob:latest
spec:
  releaseName: ccd-full
  timeout: 900
  forceUpgrade: true
  rollback:
    enable: true
    force: true
  chart:
    repository: 'https://hmctspublic.azurecr.io/helm/v1/repo/'
    name: ccd
    version: 4.0.0-rc.16
  values:
    tags:
      idam-pr: true
   
    ccd:  
      managementWeb:
        enabled: true
      apiGatewayWeb:
        enabled: true
      emAnnotation:
        enabled: true
      draftStore:
        enabled: true
      dmStore:
        enabled: true
      activityApi:
        enabled: true
      blobstorage:
        enabled: true
      printService:
        enabled: true

    global:
      idamApiUrl: https://idam-api.demo.platform.hmcts.net
      idamWebUrl: https://idam-web-public.demo.platform.hmcts.net
      ccdAdminWebIngress: ccd-admin-{{ .Release.Name }}.demo.platform.hmcts.net
      ccdApiGatewayIngress: gateway-{{ .Release.Name }}.demo.platform.hmcts.net
      ccdCaseManagementWebIngress: www-{{ .Release.Name }}.demo.platform.hmcts.net
      devMode: true
      
    ccd-admin-web:
      nodejs:
        ingressClass: traefik-no-proxy
        ingressHost: ccd-admin-{{ .Release.Name }}.demo.platform.hmcts.net
        secrets:
          IDAM_OAUTH2_AW_CLIENT_SECRET:
            disabled: false
    
    ccd-case-management-web:
      nodejs:
        ingressClass: traefik-no-proxy
        ingressHost: www-{{ .Release.Name }}.demo.platform.hmcts.net
    
    ccd-api-gateway-web:
      nodejs:
        ingressClass: traefik-no-proxy
        ingressHost: gateway-{{ .Release.Name }}.demo.platform.hmcts.net
        secrets:
          IDAM_OAUTH2_CLIENT_SECRET:
            disabled: false
            
    ccd-definition-store-api:
      java:
        secrets:
          STORAGE_ACCOUNT_NAME:
            disabled: false
          STORAGE_ACCOUNT_KEY:
            disabled: false
        environment:
          AZURE_STORAGE_DEFINITION_UPLOAD_ENABLED: true
    
    ccd-user-profile-importer:
      users:
       - auto.test.cnp@gmail.com|AUTOTEST1|AAT|TODO
    
    ccd-definition-importer:
      definitions:
       - https://github.com/hmcts/ccd-definition-store-api/raw/master/aat/src/resource/CCD_CNP_27.xlsx
      userRoles:
       - caseworker-autotest1
   
