apiVersion: flux.weave.works/v1beta1
kind: HelmRelease
metadata:
  name: latest-ccd-chart
  namespace: ccd
  annotations:
    flux.weave.works/automated: 'true'
    flux.weave.works/tag.java: 'glob:prod-*'
spec:
  releaseName: latest-ccd-chart
  timeout: 900
  forceUpgrade: true
  rollback:
    enable: true
    force: true
  chart:
    repository: 'https://hmctspublic.azurecr.io/helm/v1/repo/'
    name: ccd
    version: 4.0.0-alpha
  values:
    tags:
      idam-pr: false
    global:
      ccdApiGatewayIngress: gateway-ccd-aks.demo.platform.hmcts.net
      ccdCaseManagementWebIngress: www-ccd-aks.demo.platform.hmcts.net
      ingressHost: chart-ccd.demo.platform.hmcts.net
      idamApiUrl: https://idam-api.demo.platform.hmcts.net
      idamWebUrl: https://idam-web-public.demo.platform.hmcts.net
      redirectUri: https://latest-ccd-chart-case-management-web.demo.platform.hmcts.net/oauth2redirect
      s2sUrl: http://latest-ccd-chart-s2s
    ccd-api-gateway-web:
      ingressClass: traefik-no-proxy
      nodejs:
        ingressHost: gateway-ccd-aks.demo.platform.hmcts.net
    ccd-case-management-web:
      nodejs:
        releaseNameOverride: latest-ccd-chart-case-management-web
        ingressHost: www-ccd-aks.demo.platform.hmcts.net
    idam-pr:
      api:
        url: https://idam-api.demo.platform.hmcts.net
      web_public:
        url: https://idam-web-public.demo.platform.hmcts.net
      redirect_uris:
      CCD:
        - https://latest-ccd-chart-case-management-web.demo.platform.hmcts.net/oauth2redirect
    //TODO enable these by default on chart ccd
    ccd-admin-web:
      enabled: true
    ccd-case-activity-api:
      enabled: true
    ccd-case-print-service:
      enabled: true
    //TODO move ccd-test-stubs-service defaults to chart ccd
    ccd-test-stubs-service:
      enabled: true
      java:
        ingressHost: test-stubs-service-ccd-aks.demo.platform.hmcts.net
        livenessPath: '/health'
        releaseNameOverride: ccd-test-stubs-service
        environment:
          MANAGEMENT_WEB_URL: www-ccd-aks.demo.platform.hmcts.net
#Dependencies
    rpe-service-auth-provider:
      java:
        releaseNameOverride: latest-ccd-chart-s2s
    draft-store-service:
      enabled: true
      java:
        ingressHost:
    payment-api:
      enabled: true
