---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: backstage
  namespace: backstage
spec:
  releaseName: backstage
  rollback:
    enable: true
    retry: true
  chart:
    repository: https://hmcts.github.io/RoadieHQ-helm-charts
    name: backstage
    version: 0.2.9
  valueFileSecrets:
    - name: "backstage-values"
  values:
    frontend:
      replicaCount: 2
      image:
        repository: hmctspublic.azurecr.io/backstage/frontend
        tag: v7
    ingress:
      annotations:
        kubernetes.io/ingress.class: traefik
      enabled: true
      hosts:
        - host: backstage.sandbox.platform.hmcts.net
          paths:
            - service: frontend
        - host: backstage-api.sandbox.platform.hmcts.net
          paths:
            - service: backend
    backend:
      replicaCount: 2
      image:
        repository: hmctspublic.azurecr.io/backstage/backend
        tag: v4

    appConfig:
      app:
        baseUrl: backstage.sandbox.platform.hmcts.net
        title: HMCTS Backstage
      auth:
        github:
          development:
            appOrigin: https://backstage.sandbox.platform.hmcts.net/
      backend:
        baseUrl: https://backstage-api.sandbox.platform.hmcts.net
        cors:
          origin: https://backstage.sandbox.platform.hmcts.net
        db:
          user: backstage@hmcts-backstage-sbox
          port: 5432
          host: hmcts-backstage-sbox.postgres.database.azure.com