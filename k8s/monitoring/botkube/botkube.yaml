---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: botkube
  namespace: monitoring
  annotations:
    flux.weave.works/automated: "false"
spec:
  releaseName: botkube
  forceUpgrade: true
  chart:
    git: https://github.com/infracloudio/botkube
    ref: develop
    path: helm/botkube
  valueFileSecrets:
  - name: "botkube-values"
  values:
    image:
      tag: v0.9.1
    config:
      resources:
        - name: pod                # Name of the resources e.g pod, deployment, ingress, etc. (Resource name must be in singular form)
          namespaces:
            include:
              - all
            ignore:                 # List of namespaces to be ignored (omitempty), used only with include: all
              - # example : include [all], ignore [x,y,z] 
          events:                   # List of lifecycle events you want to receive, e.g create, update, delete, error OR all
            - error
        - name: service
          namespaces:
            include:
              - all
            ignore:
              -
          events:
            - error
        - name: deployment
          namespaces:
            include:
              - all
            ignore:
              -
          events:
            - update
            - delete
            - error
          updateSetting:
            includeDiff: true
            fields:
              - spec.template.spec.containers[*].image
              - status.availableReplicas
        - name: statefulset
          namespaces:
            include:
              - all
            ignore:
              -
          events:
            - create
            - update
            - delete
            - error
          updateSetting:
            includeDiff: true
            fields:
              - spec.template.spec.containers[*].image
              - status.readyReplicas
        - name: ingress
          namespaces:
            include:
              - all
            ignore:
              -
          events:
            - error
        - name: node
          namespaces:
            include:
              - all
            ignore:
              -
          events:
            - create
            - delete
            - error
        - name: daemonset
          namespaces:
            include:
              - all
            ignore:
              -
          events:
            - update
            - delete
            - error
          updateSetting:
            includeDiff: true
            fields:
              - spec.template.spec.containers[*].image
              - status.numberReady
        - name: job
          namespaces:
            include:
              - all
            ignore:
              -
          events:
            - error
      communications:
        # Settings for Slack
        slack:
          enabled: true
          notiftype: short
    rbac:
      rules:
        - apiGroups: [""]
          resources: ["events,namespaces,nodes,pods,services,daemonsets,deployments,ingresses,replicasets,jobs,configmaps"]
          verbs: ["get", "watch", "list"]
    resources:
      requests:
        cpu: 100m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 1Gi