---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: neuvector
  namespace: neuvector
spec:
  values:
    rules:
      admission:
        enable: true
        mode: "protect" # one of: monitor, protect
        rules:
          - '{"config":{"id":1000,"category":"Kubernetes","comment":"Allow system namespaces","criteria":[{"name":"namespace","op":"containsAny","value":"neuvector,kube-system,knode-system"}],"disable":false,"rule_type": "exception","cfg_type":"user_created"}}'
          - '{"config":{"id":1001,"category":"Kubernetes","comment":"Allow admin namespaces","criteria":[{"name":"namespace","op":"containsAny","value":"admin,kured,monitoring"}],"disable":false,"rule_type": "exception","cfg_type":"user_created"}}'
          - '{"config":{"id":1002,"category":"Kubernetes","comment":"Allow HMCTS registries","criteria":[{"name":"imageRegistry","op":"containsAny","value":"https://hmctspublic.azurecr.io/,https://hmctsprivate.azurecr.io/"}],"disable":false,"rule_type": "exception","cfg_type":"user_created"}}'
          - '{"config":{"id":1003,"category":"Kubernetes","comment":"Default deny","criteria":[{"name":"imageRegistry","op":"containsAny","value":"https://localhost/,https://*.*/"}],"disable":false,"rule_type": "deny","cfg_type":"user_created"}}'
        defaultAction: "allow"
        admClientmMde: "service"
        service: "neuvector"  
    keyvault:
      name: cft-apps-prod
      resourcegroup: core-infra-prod-rg
      subscriptionid: 8cbc6f36-7c56-4963-9d36-739db5d00b27
      tenantid: 531ff96d-0ae9-462a-8d2d-bec7c0b42082
      aadpodidbinding: neuvector
      licensesecretname: neuvector-license
      
