---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: pdf-service
  namespace: rpe
  annotations:
    fluxcd.io/automated: "true"
    repository.fluxcd.io/java: java.image
    filter.fluxcd.io/java: glob:prod-*
    repository.fluxcd.io/smokecron: java.smoketestscron.image
    filter.fluxcd.io/smokecron: glob:prod-*
    repository.fluxcd.io/functionalcron: java.functionaltestscron.image
    filter.fluxcd.io/functionalcron: glob:prod-*
    repository.fluxcd.io/smoke: java.smoketests.image
    filter.fluxcd.io/smoke: glob:prod-*
    repository.fluxcd.io/functional: java.functionaltests.image
    filter.fluxcd.io/functional: glob:prod-*
spec:
  releaseName: pdf-service
  rollback:
    enable: true
    retry: true
  chart:
    repository: https://hmctspublic.azurecr.io/helm/v1/repo/
    name: cmc-pdf-service
    version: 0.4.0
  values:
    java:
      replicas: 2
      useInterpodAntiAffinity: true
      applicationInsightsInstrumentKey: "cdd56761-038b-49e9-9fdf-b42b10e11ed5"
      image: hmctspublic.azurecr.io/cmc/pdf-service:prod-96f1ad7a
      testsConfig:
        memoryLimits: '3072Mi'
        environment:
          TEST_URL: http://pdf-service-java
          SLACK_CHANNEL: "rpe-build-notices"
          SLACK_NOTIFY_SUCCESS: "false"
      smoketestscron:
        enabled: true
        image: hmctspublic.azurecr.io/cmc/pdf-service-test:prod-96f1ad7a
        schedule: "35 0/1 * * *"
      functionaltestscron:
        enabled: true
        image: hmctspublic.azurecr.io/cmc/pdf-service-test:prod-96f1ad7a
        schedule: "45 0/6 * * *"
      smoketests:
        enabled: true
        image: hmctspublic.azurecr.io/cmc/pdf-service-test:prod-96f1ad7a
      functionaltests:
        enabled: true
        image: hmctspublic.azurecr.io/cmc/pdf-service-test:prod-96f1ad7a
    global:
      environment: aat
